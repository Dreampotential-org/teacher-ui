<!DOCTYPE html>
<html lang="en">
     <head>
          <title>Teacher Portal</title>
          <meta charset="utf-8" />
          <meta name="viewport" content="width=device-width, initial-scale=1" />

          <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
               integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"/>
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" />
          <link rel="stylesheet" type="text/css"
          href="https://cdn.datatables.net/select/1.3.3/css/select.dataTables.min.css" />

          <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
          <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

          <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
          <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
                    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
                    crossorigin="anonymous"></script>

          <!-- user.html JS, CSS start -->
          <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css"/>
          <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
          <script src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js"></script>
          <!-- firebase -->
          <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>
          <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-messaging.js"></script>
          <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDWJ2UbLhFeu3jVgd4ZwWMMNyGl4Kqx7V4"></script>
          <script src="https://cdn.datatables.net/select/1.3.3/js/dataTables.select.min.js"></script>
          <!-- user.html JS, CSS end -->

          <link rel="stylesheet" href="css/dashboard.css" />
          <!-- <link rel="stylesheet" href="css/bootstrap.css"> -->
          <link rel="stylesheet" href="css/sidebar.css" />
          <link rel="stylesheet" href="css/setting.css" />
          <link rel="stylesheet" href="css/sms.css" />
          <link rel="stylesheet" href="css/header.css" />
          <link rel="stylesheet" href="css/administration.css" />
          <link rel="stylesheet" href="css/spinner.css" />

          <script src="js/main.js"></script>
          <script src="js/web_api.js"></script>

          <!-- Country flags and code -->
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css" />
          <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>

        

          <style>
               .p-0 .container-fluid {
                    padding-left: 0px !important;
                    padding-right: 0px !important;
               }
               .video_entry, .gps-entry{
                    background-color: #80808040;
               }
               .modal-content {
                    width:100%;
               }
               .modal-dialog-centered {
                    margin-top: 10%;
               }
               .chips-shadow {
                    -moz-box-shadow:    inset 0 0 10px #000000;
                    -webkit-box-shadow: inset 0 0 10px #000000;
                    box-shadow:         inset 0 0 10px #000000;
               }
               #userLeadData #add_lead {
                    position: absolute;
                    right: 32%;
               }
               #userLeadData #importCsv {
                    position: absolute;
                    right: 23%;
               }
               #userLeadData #deleteMultiple {
                    position: absolute;
                    right: 16%;
               }
               .table-filter-container {
                    text-align: right;
               }
               #editLead, #phoneCall {
                    cursor: pointer;
               }
               #editLead:hover, #phoneCall:hover{
                    color:#5bc0de;
                    text-decoration: underline;
               }
               .iti, iti--allow-dropdown{
                    width: 100%!important;
               }
               .csv-format{
                    text-align: right;
                    text-decoration: underline;
               }

          </style>
          
          <script>
               function myFunction() {
                    var x = document.getElementById("myLinks");
                    if (x.style.display === "block") {
                    x.style.display = "none";
                    } else {
                    x.style.display = "block";
                    }
               }
          </script>
     </head>

     <body>
          <div class="container-fluid p-0">
               <!-- Bootstrap row -->
               <div class="row" id="body-row">
                    <div id="left_sidebar">
                    </div>
                    <div class="col p-0 content-div">
                         <div id="page_header">
                         </div>
                         <div class="container my-2" style="width: 100% !important;">
                              <div id="userLeadData">
                                   <div class="row">
                                        <h2>
                                             <b>User leads</b>
                                        </h2>
                                        <button class="btn btn-info"  type="button" id="add_lead">
                                             ADD
                                        </button>
                                        <button class="btn btn-info"  type="button" id="importCsv" >
                                             Import csv
                                        </button>
                                        <button type="button"  class="btn btn-danger"  id='deleteMultiple'>
                                             Delete
                                        </button>
                                   </div>
                                   <div class="table-div">
                                        <table id="lead_table" class="table table-striped table-bordered" style="width: 100%">
                                             <thead>
                                                  <tr>
                                                       <th>Action</th>
                                                       <th>Recording</th>
                                                       <th>Name</th>
                                                       <th>Phone</th>
                                                       <th>State</th>
                                                       <th>Status</th>
                                                       <th>Ask</th>
                                                       <th>Notes</th>
                                                       <th>Tax Overdue</th>
                                                       <th>Contact ID</th>
                                                       <th>Last call</th>
                                                       <th>Last Dial Number</th>
                                                       <th>Call Member</th>
                                                  </tr>
                                             </thead>
                                             <tbody id="lead_data">
                                             </tbody>
                                        </table>
                                        <div id="lead_loader" class="d-flex justify-content-center">
                                             <svg style="height: auto; width: 120px;" version="1.1"
                                                  xmlns="http://www.w3.org/2000/svg"
                                                  xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="25 25 50 50">
                                                  <circle cx="50" cy="50" r="20" fill="none" stroke-width="5" stroke="#132644" stroke-linecap="round" stroke-dashoffset="0" stroke-dasharray="100, 200">
                                                       <animateTransform attributeName="transform" attributeType="XML" type="rotate" from="0 50 50" to="360 50 50" dur="2.5s" repeatCount="indefinite"/>
                                                       <animate attributeName="stroke-dashoffset" values="0;-30;-124" dur="1.25s" repeatCount="indefinite"/>
                                                       <animate attributeName="stroke-dasharray" values="0,200;110,200;110,200" dur="1.25s" repeatCount="indefinite"/>
                                                  </circle>
                                             </svg>
                                        </div>
                                   </div>
                              </div>
                              
                              <!-- add new lead to db -->
                              <div id="addLead" style='display:none'>
                                   <div>
                                        <button onclick="goBack()" class="btn">
                                             <i class="fa fa-chevron-left"></i> Back
                                        </button>
                                   </div>
     
                                   <h2 class="text-center">
                                        <b id="addTitle">Add New Lead</b>
                                   </h2>
     
                                   <form class="pt-2 pt-3">
                                        <div class="form-group">
                                             <label for="name">Name</label>
                                             <input type="text" class="form-control" id="name" placeholder="Name" />
                                        </div>
                                        <div class="form-group">
                                             <label class="d-block" for="phone">Phone</label>
                                             <input type="phone" class="form-control" id="phone" placeholder="Phone" />
                                        </div>
                                        <div class="form-group">
                                             <label for="email">email</label>
                                             <input type="email" class="form-control" id="email" placeholder="email" />
                                        </div>
                                        <div class="form-group">
                                             <label for="state">State</label>
                                             <input type="text" class="form-control" id="state" placeholder="State" />
                                        </div>
                                        <div class="form-group">
                                             <label for="ask">Ask</label>
                                             <input type="text" class="form-control" id="ask" placeholder="Ask" />
                                        </div>
                                        <div class="form-group">
                                             <label for="new_notes">Notes</label>
                                             <input type="text" class="form-control" id="new_notes" placeholder="full Notes" />
                                        </div>
                                        <div class="form-group">
                                             <label for="new_url">Zillow url</label>
                                             <input type="text" class="form-control" id="new_url" placeholder="Zillow url" />
                                        </div>
                                        <button type="button" id="save_new_lead" class="btn btn-primary">
                                             Submit
                                        </button>
                                   </form>
                              </div>

                              <!-- edit user-lead -->
                              <div id="editLeadModel" style='display:none'>
                                   <div>
                                        <button onclick="goBackEdit()" class="btn">
                                             <i class="fa fa-chevron-left"></i> Back
                                        </button>

                                        <button class="btn btn-danger float-right" id="deleteLead">
                                             <i class="fa fa-trash"></i> Delete
                                        </button>
                                   </div>
     
                                   <h2 class="text-center">
                                        <b id="addTitle">Edit Lead</b>
                                   </h2>
     
                                   <form class="pt-2 pt-3">
                                        <div class="form-group">
                                             <label for="edit_name">Name</label>
                                             <input type="text" class="form-control" id="edit_name" placeholder="Name" />
                                        </div>
                                        <div class="form-group">
                                             <label for="edit_phone">Phone</label>
                                             <input type="phone" class="form-control" id="edit_phone" placeholder="Phone" />
                                        </div>
                                        <div class="form-group">
                                             <label for="edit_email">email</label>
                                             <input type="email" class="form-control" id="edit_email" placeholder="email" />
                                        </div>
                                        <div class="form-group">
                                             <label for="edit_state">State</label>
                                             <input type="text" class="form-control" id="edit_state" placeholder="State" />
                                        </div>
                                        <div class="form-group">
                                             <label for="edit_ask">Ask</label>
                                             <input type="text" class="form-control" id="edit_ask" placeholder="Ask" />
                                        </div>
                                        <div class="form-group">
                                             <label for="edit_notes">Notes</label>
                                             <input type="text" class="form-control" id="edit_notes" placeholder="full Notes" />
                                        </div>
                                        <div class="form-group">
                                             <label for="edit_url">Zillow url</label>
                                             <input type="text" class="form-control" id="edit_url" placeholder="Zillow url" />
                                        </div>
                                        <div>
                                             <label for="edit_status">select status</label>
                                             <select class="form-control" id="edit_status">
                                                  <option value="-" selected="">-</option>
                                                  <option value="Call back later">Call back later</option>
                                                  <option value="not interested">not interested</option>
                                             </select><br>
                                        </div>
                                        <button type="button" id="submitLead" class="btn btn-primary">
                                             Submit
                                        </button>
                                   </form>
                              </div>
                              

                              <!-- overlay  csv uploder  -->
                              <div class="modal fade" id="csvModel" tabindex="-1" aria-labelledby="csvModel" role="dialog" aria-hidden="true">
                                   <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                             <div class="modal-header">
                                                  <h5 class="modal-title">
                                                       upload a csv file
                                                  </h5>
                                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                       <span aria-hidden="true">&times;</span>
                                                  </button>
                                             </div>
                                             <div class="modal-body">
                                                  <div class="form-group" style="margin-top: 10px;">
                                                        
                                                       <div class="csv-format">
                                                            <a href="sample.csv" download="sample.csv">Download csv format</a>
                                                       </div>
                                                       <div class="form-group">
                                                            <label for="csvFile">choose csv file</label>
                                                            <input type="file" name="csvFile" class="form-control" id="csvFile" required />
                                                       </div>
                                                       <div class="modal-footer">
                                                            <button class="btn btn-primary float-right" id="uplodCsv" type="submit"><i class="fal fa-file-csv"></i>Upload</button> 
                                                       </div>
                                                  </div>
                                             </div>
                                        </div>
                                   </div> 
                              </div>
                              <!-- csv uploder over -->


                              <!--select number  1'st overlay  -->
                              <div class="modal fade" id="selectNumberModel" tabindex="-1" aria-labelledby="selectNumberModel" role="dialog" aria-hidden="true">
                                   <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                             <div class="modal-header">
                                                  <h5 class="modal-title">
                                                       select Number
                                                  </h5>
                                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                       <span aria-hidden="true">&times;</span>
                                                  </button>
                                             </div>
                                             <div class="modal-body">
                                                  <div class="form-group" style="margin-top: 10px;">
                                                       <div class="form-group">
                                                            <label for="sourceCallNumber">select source Number</label>
                                                            <select class="form-control" id="sourceCallNumber">
                                                                 <option value="Select Source Number" selected>Select Source Number</option>
                                                                 <option value="(425) 578-5798">(425) 578-5798</option>
                                                            </select>
                                                       </div>
                                                       <div class="form-group">
                                                            <label for="dest_num_call">Destination number</label>
                                                            <input type="tel" class="form-control" id="dest_num_call" disabled placeholder="Dest Number"  required/>
                                                       </div>
                                                       <div class="form-group">
                                                            <label for="yourNumber">your number</label>
                                                            <input type="tel" class="form-control" id="yourNumber" placeholder="Your Number for join_conference"  required/>
                                                       </div>
                                                       <div class="modal-footer">
                                                            <button class="btn btn-primary float-right" id="makeCall" type="button"><i class="fa fa-phone-square"></i> Call</button> 
                                                       </div>
                                                  </div>
                                             </div>
                                        </div>
                                   </div> 
                              </div>

                              <!-- 2'nd overlay Add notes on number called -->
                              <div class="modal fade" id="notesModal" aria-labelledby="notesModal" tabindex="-1" role="dialog" aria-hidden="true">
                                   <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                             <div class="modal-header">
                                                  <h5 class="modal-title">
                                                       Enter the notes for this Member
                                                  </h5>
                                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                       <span aria-hidden="true">&times;</span>
                                                  </button>
                                             </div>
                                             <div class="modal-body">
                                                  <div id="music_files"></div>  
                                                  <br><br>
                                                  <div id="Zillow_url"></div>
                                                  <div class="form-group" style="margin-top: 10px;">
                                                       <label for="status_val">select status</label>
                                                       <select class="form-control" id="status_val">
                                                            <option value="-" selected="">-</option>
                                                            <option value="Call back later">Call back later</option>
                                                            <option value="not interested">not interested</option>
                                                       </select><br>
                                                       <label for="phone">Notes</label>
                                                       <textarea class="form-control" id="notes_call" placeholder="write Notes"></textarea>
                                                  </div>
                                                  <div class="modal-footer">
                                                       <button type="button" id="save_notes" class="btn btn-primary float-right">
                                                            save
                                                       </button>
                                                       <button type="button" id="next_call" class="btn btn-primary float-right">
                                                            next
                                                       </button>
                                                  </div>
                                             </div>
                                        </div>
                                   </div> 
                              </div>
                         </div>
                    </div>
               </div>
          </div>

          <!-- DataTable - filter -->
          <p id="table_filter" style="display:none">
               filter: 
               <select>
               <option value="">ALL</option>
               <option value="-">-</option>
               <option>Call back later</option>
               <option>not interested</option>
               </select>
          </p>

          <script>
               var passwordResetToken = getParam("token");
               var userToken = localStorage.getItem("user-token");
               
               console.log("MODE: PASSWORD_RESET, Token - " + passwordResetToken);
               
               if (userToken == null) {
                    window.location.replace("student_login.html");
               }
               function getParam(sParam) {
                    var sPageURL = window.location.search.substring(1);
                    var sURLVariables = sPageURL.split("&");
                    for (var i = 0; i < sURLVariables.length; i++) {
                         var sParameterName = sURLVariables[i].split("=");
                         if (sParameterName[0] == sParam) {
                              return sParameterName[1];
                         }
                    }
               }
               
               $(document).ready(function () {
                    $("#left_sidebar").load("sidebar.html");
                    $("#page_header").load("header.html");
               });
               $("#body-row .collapse").collapse("hide");

               function left_sidebar() {
                    SidebarCollapse();
               }
               
               function SidebarCollapse() {
                    $(".menu-collapsed").toggleClass("d-none");
                    $(".sidebar-submenu").toggleClass("d-none");
                    $(".submenu-icon").toggleClass("d-none");
                    $("#sidebar-container").toggleClass(
                         "sidebar-expanded sidebar-collapsed"
                    );

                    var SeparatorTitle = $(".sidebar-separator-title");
                    if (SeparatorTitle.hasClass("d-flex")) {
                         SeparatorTitle.removeClass("d-flex");
                    } else {
                         SeparatorTitle.addClass("d-flex");
                    }
               }
               var user_list = [];
               var selected_user_index;
               var user_leads;
               var call_data;
               var table;
               $(document).ready(function () {

                    $.ajax({
                         url : SERVER + "voip/api_voip/getlead",
                         async : true,
                         crossDomain : true,
                         crossOrigin : true,
                         type : 'GET',
                         headers: { "Authorization": `${localStorage.getItem('user-token')}` }
                    }).done( (response)=> {
                         document.getElementById("lead_loader").remove();
                         user_leads = JSON.parse(response)
                         user_leads.forEach((item , index) => {
                              $("#lead_data").append(`<tr>
                                   <td onclick=check_box(${item.pk})></td>
                                   <td><audio src="${item.fields.recording_url ? item.fields.recording_url:""}" controls> </audio></td>
                                   <td id="editLead" onClick=editLead(${index})>${item.fields.name}</td>
                                   <td id="phoneCall" onclick="selectNum('${index}')">${item.fields.phone}</td>
                                   <td>${item.fields.state}</td>
                                   <td>${item.fields.status}</td>
                                   <td>${item.fields.ask}</td>
                                   <td>${item.fields.notes}</td>
                                   <td>${item.fields.tax_overdue}</td>
                                   <td>${item.fields.contact_id}</td>
                                   <td>${item.fields.last_call || "-"}</td>
                                   <td>${item.fields.last_dial_number || "-"}</td>
                                   <td><button onclick="selectNum('${index}')" class="btn btn-primary btn-edit" type="button"><i class="fa fa-phone-square"></i></button></td>
                                   </tr>`);
                         })
                         // DataTable and modification
                         table = $("#lead_table").DataTable( {
                              dom: 'lr<"table-filter-container">tip',
                                   initComplete: function(settings){
                                        var api = new $.fn.dataTable.Api( settings );
                                        $('.table-filter-container', api.table().container()).append(
                                             $('#table_filter').detach().show()
                                        );
                                        $('#table_filter select').on('change', function(){
                                             table.search(this.value).draw();   
                                        });
                                   }, 
                              columnDefs: [{
                                   orderable: false,
                                   className: 'select-checkbox',
                                   targets: 0,
                                   checkboxes: {
                                                  'selectRow': true
                                             }
                              }],
                              select: {
                                   'style': 'multi',
                                   'selector': 'td:first-child'
                                   },
                              order: [[1, 'asc']]
                         });
                         var select = table.column(0).checkboxes;
                    }).fail((err) => {
                         console.log("ðŸš€ ~ file: leads.html ~ line 522 ~ err", err)
                         console.log("errorss...",err)
                    })
               });

               // open csvUploder model
               $('#importCsv').click( () =>{
                    $('#csvModel').modal()
               })

               // submit csvFile
               $("#uplodCsv").click(function() {
                    var form = new FormData();
                    form.append("csvFile", document.getElementById("csvFile").files[0])
                    var settings = {
                         "async": true,
                         "crossDomain": true,
                         "url": SERVER + "voip/api_voip/csvUploder",
                         "type": "POST",
                         "processData": false,
                         "contentType": false,
                         "mimeType": "multipart/form-data",
                         "data": form,
                         "headers": {	
                              "Authorization": `${localStorage.getItem('user-token')}`	
                         },
                    };
                    $.ajax(settings).done(function (response) {
                         swal({
                              title: "Good job!",
                              icon: "success",
                              button: "Aww yess!",
                              text: JSON.parse(response).message,
                              timer: 3000,
                         });
                         setTimeout(function(){location.reload()}, 3000);  
                    }).fail(function (err)  {
                         swal({
                              title: "Error!",
                              text: JSON.parse(err.responseText).message,
                              icon: "warning",
                              button: "do it again",
                              timer: 4000,
                         });
                    });
               })

               // edit lead model open
               function editLead(index) {
                    $("#userLeadData").hide();
                    $('#editLeadModel').show();
                    $('#submitLead').val(user_leads[index].pk)
                    $('#deleteLead').val(user_leads[index].pk)
                    $('#edit_name').val(user_leads[index].fields.name)
                    $('#edit_phone').val(user_leads[index].fields.phone)
                    $('#edit_email').val(user_leads[index].fields.email)
                    $('#edit_state').val(user_leads[index].fields.state)
                    $('#edit_ask').val(user_leads[index].fields.ask)
                    $('#edit_notes').val(user_leads[index].fields.notes)
                    $('#edit_url').val(user_leads[index].fields.url)
                    $('#edit_status').val(user_leads[index].fields.status)
               }

               // go back from editPage 
               function goBackEdit() {
                    $("#userLeadData").show();
                    $("#editLeadModel").hide();
               }

               // delete lead from editPage
               $('#deleteLead').click( () => {
                    pk = $('#deleteLead').val()
                    $.ajax({
                         url : SERVER + "voip/api_voip/getlead",
                         async : true,
                         crossDomain : true,
                         crossOrigin : true,
                         type : "DELETE",
                         data : {
                              'pk' : pk,
                         },
                         headers: { "Authorization": `${localStorage.getItem('user-token')}` }
                    }).done( () => {
                         swal({	
                              title: " lead Deleted",
                              text: "You have successfully delete lead",	
                              icon: "success",
                              timer: 2000
                         })
                         location.reload()
                    }).fail( (err) => {
                         console.log(err)
                    })
               })

               // submit edited lead
               $("#submitLead").click( () => {
                    pk = $('#submitLead').val()
                    name = $('#edit_name').val()
                    phone = $('#edit_phone').val()
                    email = $('#edit_email').val()
                    state = $('#edit_state').val()
                    ask = $('#edit_ask').val()
                    notes = $('#edit_notes').val()
                    url = $('#edit_url').val()
                    status = $('#edit_status').val()
                    $.ajax({
                         url : SERVER + "voip/api_voip/getlead",
                         async : true,
                         crossDomain : true,
                         crossOrigin : true,
                         type : "PUT",
                         data : {
                              'pk' : pk,
                              'name' : name,
                              'phone' : phone, 
                              'email' : email, 
                              'state' : state, 
                              'ask' : ask, 
                              'notes' : notes,
                              'url' : url,
                              'status' : status,
                         },
                         headers: { "Authorization": `${localStorage.getItem('user-token')}` }
                    }).done( () => {
                         swal({	
                              title: "edit saved",
                              text: "You have successfully edited lead",	
                              icon: "success",
                              timer: 2000
                         })
                         location.reload()
                    }).fail( (err) => {
                         console.log(err)
                    })
               }) 
               
               // checkbox - check & uncheck
               var list_delete = []
               function check_box(id){
                    if (list_delete.indexOf(id) === -1) {  
                         list_delete.push(id)
                    }
                    else{
                         const index = list_delete.indexOf(id);
                         if (index > -1) {
                              list_delete.splice(index, 1);
                         }
                    }
               }

               //  select and delete multipleLead
               $('#deleteMultiple').click( () =>{
                    if ( list_delete.length !== 0 ){
                         swal({
                              title: "Are you sure?",
                              text: "Once deleted, you will not be able to recover this leads Again!",
                              icon: "warning",
                              buttons: true,
                              dangerMode: true,
                         })
                         .then((willDelete) => {
                              if (willDelete) {
                                   $.ajax({
                                        url : SERVER + "voip/api_voip/getlead" + "?listPk="+ list_delete,
                                        async : true,
                                        crossDomain : true,
                                        crossOrigin : true,
                                        type : "DELETE",
                                        headers: { "Authorization": `${localStorage.getItem('user-token')}` }
                                   }).done( () => {
                                        swal({	
                                             title: "multiple leads Deleted",
                                             text: "You have successfully delete leads",	
                                             icon: "success",
                                             timer: 2000
                                        })
                                        location.reload()
                                   }).fail( (err) => {
                                        console.log(err)
                                   }) 
                              } else {
                                   swal("Your selected leads are safe!");
                              }
                              });
                    }
                    else{
                         swal({	
                              text: "select lead to delete",	
                              icon: 'warning',
                              title: 'Oops...',
                         })
                    }
               })

               // open new lead page.
               $("#add_lead").click( () => {
                    $("#userLeadData").hide();
                    $("#addLead").show();
               })

               // go back from newLead
               function goBack() {
                    $("#userLeadData").show();
                    $("#addLead").hide();
               }

               // submit new lead
               const phoneInputField = document.querySelector("#phone");
               const phoneInput = window.intlTelInput(phoneInputField, {
                 utilsScript:
                   "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
               });
               
               $('#save_new_lead').click( () => {           
                    name = $('#name').val()
                    phone = phoneInput.getNumber()
                    email = $('#email').val()
                    state = $('#state').val()
                    ask = $('#ask').val()
                    notes = $('#new_notes').val()
                    new_url = $('#new_url').val()
                    $.ajax({
                         url : SERVER + "voip/api_voip/getlead",
                         async : true,
                         crossOrigin : true,
                         crossDomain : true,
                         type : 'POST',
                         data : {
                              'name' : name,
                              'phone' : phone, 
                              'email' : email, 
                              'state' : state, 
                              'ask' : ask, 
                              'notes' : notes,
                              'new_url' : new_url,
                         },
                         headers: { "Authorization": `${localStorage.getItem('user-token')}` }
                    }).done( () => {
                         swal({	
                              title: "leads saved",
                              text: "You have successfully saved leads",	
                              icon: "success",
                              timer: 2000
                         })
                         location.reload()
                    }).fail( (err) => {
                         console.log(err);
                    })
               })

               // open 1'st overlay
               function selectNum(index) {
                    $("#selectNumberModel").modal();
                    $("#makeCall").val(index)
                    $("#dest_num_call").val(user_leads[index].fields.phone)
               }

               // makeCall and open overlay 2
               var source_num;
               var dest_num;
               var index;
               var your_num;
               const yourNumberInputField = document.querySelector("#yourNumber");
               const yourNumberInput = window.intlTelInput(yourNumberInputField, {
                 utilsScript:
                   "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
               });
               $("#makeCall").click( () => {
                    index = $("#makeCall").val()
                    source_num = $('#sourceCallNumber option:selected').val()
                    dest_num = $("#dest_num_call").val()
                    your_num = yourNumberInput.getNumber()

                    if (source_num === 'Select Source Number'){
                         swal({	
                              title: "Select source number",
                              text: "You have to select source number",	
                              icon: "warning",
                              timer: 2000
                         })
                    } else if (your_num === ''){
                         swal({	
                              title: "Enter designation number",
                              text: "You have to enter  number",	
                              icon: "warning",
                              timer: 2000
                         })
                    } else{

                         $("#save_notes").val(user_leads[index].pk)
                         $("#notesModal").modal();
                         $("#Zillow_url").empty();
                         $("#Zillow_url").append(`name : ${user_leads[index].fields.name}  <br> Zillow url : <a href="${user_leads[index].fields.url}">${user_leads[index].fields.url}</a> <br><br>`);
                         $('#notes_call').val(user_leads[index].fields.notes);
                         
                         $.ajax({
                              url : SERVER + "voip/api_voip/join_conference",
                              async : true,
                              crossDomain : true,
                              crossOrigin : true,
                              type : 'POST',
                              data : {
                                   "source_number" : source_num,
                                   "dest_number" : dest_num,
                                   "your_number" : your_num,
                                   "id": user_leads[index].pk
                                   
                         },
                         headers: { "Authorization": `${localStorage.getItem('user-token')}` }
                    }).done( ()=> {                        
                        table.reload();
                    })
               }
               })

               $("#next_call").click( () => {
                    $("#notesModal").toggle();
                    $('#notesModal').modal('hide'); 
               })

               // play pause music on conference call.
               var audio_files = {
                    'koyal_bird' : "https://audio-previews.elements.envatousercontent.com/files/237106115/preview.mp3",
                    'insects_voice' : "https://assets.mixkit.co/sfx/preview/mixkit-small-birds-in-the-nest-29.mp3",
                    'one_bird' : "https://orangefreesounds.com/wp-content/uploads/2021/04/Bird-tweeting-sound-effect.mp3",
                    'picock_bird' : "http://seh-audio.s3.amazonaws.com/peacock_sounds_long.wav",
                    'koyal_bird' : "https://nf1f8200-a.akamaihd.net/downloads/ringtones/files/mp3/beautiful-koyal-real-sound-mp3-good-morning-songsindia-net-9993.mp3",
                    'insects_voice_2' : "https://assets.mixkit.co/sfx/preview/mixkit-little-birds-singing-in-the-trees-17.mp3"
               }

               for (let file in audio_files) {
                    console.log(file + ' is ' + audio_files[file])
                    $("#music_files").append(
                         `<div>
                              <audio id='${file}'>
                              <source src=${audio_files[file]} type="audio/mpeg">
                                   Your browser does not support the audio element.
                              </audio>
                              <button class="btn btn-info" onclick="playAudio('${file}')" type="button"> <i class="fa fa-play" aria-hidden="true"></i></button>
                              <button class="btn btn-primary" onclick="pauseAudio('${file}')" type="button"><i class="fa fa-pause" aria-hidden="true"></i></button> 
                              ${file}                                                  
                         </div>`
                    )
               }
               // function to play audio
               function playAudio(key) {
                    console.log(key)
                    var x = document.getElementById(key);
                    x.play(); 
               } 
               // function to pause audio
               function pauseAudio(key) { 
                    console.log(key)
                    var x = document.getElementById(key);
                    x.pause(); 
               } 

               // save notes and status to db
               $("#save_notes").click( () => {
                    status = $('#status_val').val();
                    notes = $('#notes_call').val();
                    $.ajax({
                         url : SERVER + "voip/api_voip/getlead",
                         async : true,
                         crossDomain : true,
                         crossOrigin : true,
                         type : "PUT",
                         data : {
                              "pk" : user_leads[index].pk,
                              "notes" : notes,
                              "status" : status,
                              "last_dial_number" : your_num
                         },
                         headers: { "Authorization": `${localStorage.getItem('user-token')}` }
                    }).done( () => {
                         console.log("done")
                         swal({	
                              title: "notes saved",
                              text: "You have successfully saved notes",	
                              icon: "success",
                              timer: 2000
                         })
                         location.reload()
                    }).fail( (err) => {
                         console.log(err)
                    })
               })

               $(document).ready(function(){
                    $('[data-toggle="tooltip"]').tooltip();
               });
          </script>
     </body>
</html>