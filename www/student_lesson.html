<!DOCTYPE html>
<html lang="en">

<head>
    <title>Teacher Portal</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <!-- user.html JS, CSS start -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css" />
    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- user.html JS, CSS end -->

    <link rel="stylesheet" href="css/dashboard.css" />
    <link rel="stylesheet" href="css/sidebar.css" />
    <link rel="stylesheet" href="css/setting.css" />
    <link rel="stylesheet" href="css/sms.css" />
    <link rel="stylesheet" href="css/header.css" />
    <link rel="stylesheet" href="css/administration.css" />
    <link rel="stylesheet" href="css/student_dashboard.css" />
    <link rel="stylesheet" href="css/student_lesson.css" />
    <!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous"> -->

    <script src="js/main.js"></script>
    <script src="js/web_api.js"></script>
    <script src="js/student_dashboard.js"></script>
    <script src="js/student_lesson.js"></script>

    <style>
        .p-0 .container-fluid {
            padding-left: 0px !important;
            padding-right: 0px !important;
        }
    </style>

    <script>
        function myFunction() {
            var x = document.getElementById("myLinks");
            if (x.style.display === "block") {
                x.style.display = "none";
            } else {
                x.style.display = "block";
            }
        }
    </script>
</head>

<body>
    <div class="container-fluid p-0">
        <!-- Bootstrap row -->
        <div class="row" id="body-row">
            <div id="left-sidebar"></div>
            <div class="col p-0 content-div">
                <div id="page-header"></div>
                <div class="container">

                    <!-- <div class="container start-container"> -->
                    <div class="container start-container">
                        <div>
                            <div class="row">

                                <div class="col-xs-6 col-sm-6">
                                    <p>Segment Builder</p>
                                    <select class="form-control" id="select_lesson" onchange="selectLesson()">
  
                      </select>
                                    <div class="row anchor">
                                        <a id="lesson_slide" class="col-lg-12 col-sm-12 col-md-12">View Lesson</a>
                                    </div>

                                    <div class="row anchor">
                                        <a id="lesson_responses" class="col-lg-12 col-sm-12 col-md-12">View Responses</a>
                                    </div>
                                </div>
                                <div class="col-xs-6 col-sm-6" style="margin-top: 20px;margin-bottom: 10px;">

                                    <div class="col-xs-12 col-sm-12" align="right">
                                        <a href="settings.html" class="btn btn-primary">
                                            <span style="font-size: 25px;" class="fa fa-wrench"></span></a>
                                    </div>
                                    <!-- <i class="fas fa-wrench"></i> -->
                                    <select class="form-control " id="selectsegment">
                          <option selected value="select_type">Select Segment Type</option>
                          <option value="speed_read">Speed Read</option>
                          <option value="title_text">Title Text</option>
                          <option value="question_choices">Question Choices</option>
                          <option value="iframe_link">Iframe Link</option>
                          <option value="video_file">Video File</option>
                          <option value="question_text">Question Text</option>
                          <option value="sign_b64">Signature Image</option>
                      </select>
                                    <button class="btn form-control btn-success" style="margin-top: 20px;margin-bottom: 10px;" id="add">Add</button>
                                    <input type="text" class="form-control" name="lesson_name" id="lesson_name" placeholder="Lesson Name">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12" id="sortable">

                                </div>
                                <div class="col-xs-12">
                                    <form id="lesson_form">
                                        <div class="speed_read" id="speed_read" style="display: none; padding-top: 15px">
                                            <div class="ui-sortable-handle" style="margin-top:50px; padding:20px; border-radius:10px; border:1px; border-color:#888; border-style:solid;">
                                                <div class="row">
                                                    <h4 class="col-xs-10 col-lg-10">Speed Read</h4>
                                                    <a class="remove_flashcard col-xs-2 col-lg-2" style="color:red;font-weight:bold;font-size:23px;text-align:right;"> X </a>
                                                </div>

                                                <div class="form-group">
                                                    <textarea class="form-control" name="speed_read" rows="7" placeholder=""></textarea>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="speed_read" id="question_text" style="display: none; padding-top: 15px">
                                            <div style="margin-top:50px; padding:20px; border-radius:10px; border:1px; border-color:#888; border-style:solid;">
                                                <div class="row">
                                                    <h4 class="col-xs-10 col-lg-10">Question Text</h4>
                                                    <a class="remove_flashcard col-xs-2 col-lg-2" style="color:red;font-weight:bold;font-size:23px;text-align:right;"> X </a>
                                                </div>

                                                <div class="form-group">
                                                    <textarea class="form-control" name="speed_read" rows="7" placeholder=""></textarea>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="speed_read" id="title_text" style="display: none; padding-top: 15px">
                                            <div style="margin-top:50px; padding:20px; border-radius:10px; border:1px; border-color:#888; border-style:solid;">
                                                <div class="row">
                                                    <h4 class="col-xs-10 col-lg-10">Title Text</h4>
                                                    <a class="remove_flashcard col-xs-2 col-lg-2" style="color:red;font-weight:bold;font-size:23px;text-align:right;"> X </a>
                                                </div>
                                                <div class="form-group">
                                                    <input type="text" class="form-control" id="title" placeholder="Title">
                                                </div>
                                                <div class="form-group">
                                                    <textarea class="form-control" id="text" rows="7" placeholder=""></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="speed_read" id="question_choices" style="display: none; padding-top: 15px">
                                            <div style="margin-top:50px; padding:20px; border-radius:10px; border:1px; border-color:#888; border-style:solid;">
                                                <div class="row">
                                                    <h4 class="col-xs-10 col-lg-10">Question Choices</h4>
                                                    <a class="remove_flashcard col-xs-2 col-lg-2" style="color:red;font-weight:bold;font-size:23px;text-align:right;"> X </a>
                                                </div>
                                                <div class="form-group">
                                                    <input type="text" class="form-control" id="question" placeholder="Question">
                                                </div>
                                                <div class="form-group" id="choices">
                                                    <div>
                                                        <input type="text" class="form-control" rows="7" placeholder="Choices"><button onclick="$(this).parent().remove()">Remove Choice</button>
                                                    </div>
                                                </div>
                                                <button>Add Choice</button>
                                                <div class="form-group">
                                                    <hr>
                                                    <input type="button" id="upload-img-btn" onclick="handleImageUpload()" value="Upload Image" />
                                                    <input type="text" class="form-control" id="image" placeholder="Image Link" />
                                                    <div id="output"></div>
                                                </div>

                                            </div>
                                            <div class="speed_read" id="video_file" style="display: none; padding-top: 15px">
                                                <div style="margin-top:50px">
                                                    <div class="row">
                                                        <h4 class="col-xs-10 col-lg-10">Video File</h4>
                                                        <a class="remove_flashcard col-xs-2 col-lg-2" style="color:red;font-weight:bold;font-size:23px;text-align:right;"> X </a>
                                                    </div>
                                                    <div class="form-group">
                                                        <input type="text" class="form-control" id="video_title" placeholder="Title">
                                                    </div>

                                                    <div class="form-group">
                                                        <input type="button" id="upload-vid-btn" onclick="handleVideoUpload()" value="Upload Video" />
                                                        <input type="text" class="form-control" id="video" placeholder="Video Link" />
                                                    </div>
                                                    <div id="video-output" style="display: none">
                                                        <video id="videoplayer" controls preload="none" height="360" style="width: 100%;">
                                          </video>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="speed_read" id="iframe_link" style="display: none; ping-top: 15px">
                                            <div style="margin-top:50px; padding:20px; border-radius:10px; border:1px; border-color:#888; border-style:solid;">
                                                <div class="row">
                                                    <h4 class="col-xs-10 col-lg-10">Iframe Link</h4>
                                                    <a class="remove_flashcard col-xs-2 col-lg-2" style="color:red;font-weight:bold;font-size:23px;text-align:right;"> X </a>
                                                </div>
                                                <div class="form-group">
                                                    <input type="text" class="form-control" id="title_iframe" placeholder="Title">
                                                </div>

                                                <div class="form-group">
                                                    <input type="text" class="form-control" id="iframe" placeholder="IFrame Link" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="speed_read" id="sign_b64" style="display: none; padding-top: 15px">
                                            <div style="margin-top:50px">
                                                <div class="row">
                                                    <h4 class="col-xs-10 col-lg-10">Signature</h4>
                                                    <a class="remove_flashcard col-xs-2 col-lg-2" style="color:red;font-weight:bold;font-size:23px;text-align:right;"> X </a>
                                                </div>

                                                <div class="form-group">
                                                    <input type="text" hidden name="input_signature" id="signInput">
                                                    <button class="btn btn-primary" type="button" onclick="signLesson(event, 'lesson_signature', 'signInput')"> Click To Sign</button>
                                                    <img id="lesson_signature" hidden src="">
                                                </div>
                                            </div>
                                        </div>
                                </div>
                                <div class="col-xs-12 save-button">
                                    <button type="submit" class="form-control btn btn-primary save-button" style="margin-top: 50px;">Save</button>
                                </div>
                                </form>
                            </div>
                        </div>

                    </div>

                    <form id="imageUploadForm" enctype="multipart/form-data" name="imageUploadForm">
                        <input type="file" name="imageUpload" id="imageUpload" style='display:none;' onchange="handleImageSelect(this)" required/>
                    </form>

                    <form id="videoUploadForm" enctype="multipart/form-data" name="videoUploadForm">
                        <input type="file" name="videoUpload" id="videoUpload" style='display:none;' onchange="handleVideoSelect(this)" required/>
                    </form>

                    <div id="sign-modal"></div>

                </div>
            </div>
        </div>
    </div>
    </div>
    <!-- /.container-fluid -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

    <script>
        $('#sign-modal').load("signature/index.html");

        function signLesson(event, imgId, signInput) {
            if ($('#signature')) {
                $('#signature').modal('show');
            }
            document.addEventListener('signatureSubmitted', function(e) {
                $('#' + signInput).val(window.currentSignature.data);
                $('#' + imgId).attr('src', window.currentSignature.data);
                $('#' + imgId).removeAttr('hidden');
                event.target.innerHTML = 'Redraw Signature';
                // window.currentSignature = undefined;
            });
        }
    </script>
    <script>
        $(document).ready(function() {
            $("#sortable").sortable({
                stop: sortEventHandler
            });

            function sortEventHandler() {
                var i = 0;
                var childrenList = $("#sortable").children();
                childrenList.each(function(e) {
                    $(this).attr("data-position", i)
                    i++;
                })
            }
        });
    </script>

    <script>
        $(document).ready(function() {
            $("#left-sidebar").load("sidebar.html");
            $("#page-header").load("header.html");
            //                        $("#page-container").load('dashboard.html');
        });
        $("#body-row .collapse").collapse("hide");

        // Collapse/Expand icon
        //$('#collapse-icon').addClass('fa-angle-double-left');

        // Collapse click
        function left_sidebar() {
            SidebarCollapse();
        }

        function SidebarCollapse() {
            $(".menu-collapsed").toggleClass("d-none");
            $(".sidebar-submenu").toggleClass("d-none");
            $(".submenu-icon").toggleClass("d-none");
            $("#sidebar-container").toggleClass(
                "sidebar-expanded sidebar-collapsed"
            );

            // Treating d-flex/d-none on separators with title
            var SeparatorTitle = $(".sidebar-separator-title");
            if (SeparatorTitle.hasClass("d-flex")) {
                SeparatorTitle.removeClass("d-flex");
            } else {
                SeparatorTitle.addClass("d-flex");
            }

            // Collapse/Expand icon
            //$('#collapse-icon').toggleClass('fa-angle-double-left fa-angle-double-right');
        }
        // var ctx = document.getElementById("myPieChart");

        // var myPieChart = new Chart(ctx, {
        //     type: 'pie',
        //     data: {
        //         labels: ["White", "Black", "Lation", "Indian"],
        //         datasets: [{
        //             data: [20, 15, 5, 10],
        //             backgroundColor: ['#f73378', "#9c27b0", "#ee99fc", "#3d5afe"],
        //         }]
        //     },
        //     options: {
        //         legend: {
        //             display: true,
        //             labels: {
        //                 fontColor: '#000',
        //                 //boxWidth:50,
        //                 fontSize: 14
        //                 //fontSize:'26px'
        //                 //fontWeight:700
        //             }
        //         },
        //         elements: {
        //             arc: {
        //                 borderWidth: 0
        //             }
        //         }
        //     }
        // });

        $(document).ready(function() {
            list_question_counters(function(questions) {
                console.log(questions);

                getChart(questions);
            });
        });

        function getChart(item) {
            item.forEach((ele, i) => {
                console.log(ele);

                var html = `<div class="col-xl-6 col-sm-12 mb-6">

                                <div class="card mb-3">
                                    <div class="card-header">
                                        ${ele.question}
                                    </div>
                                    <div id="chart-body${i}" class="card-body">
                                    </div>
                                    <div id="legend${i}" class="custom-legend"></div>
                                </div>

                                </div>`;

                $("#customChart").append(html);

                var canvas = document.createElement("canvas");

                canvas.id = "canavs" + i;
                //canvas.width = "50%";

                var body = document.getElementById("chart-body" + i);
                body.appendChild(canvas);

                var ctx = document.getElementById("canavs" + i);

                var custom_labels = [];
                var counter = [];

                ele.answers.forEach((element) => {
                    custom_labels.push(element.answer);
                    counter.push(element.count);
                });

                var myPieChart = new Chart(ctx, {
                    type: "pie",
                    data: {
                        labels: custom_labels,
                        datasets: [{
                            data: counter,
                            backgroundColor: ["#f73378", "#9c27b0", "#ee99fc", "#3d5afe"],
                        }, ],
                    },
                    options: {
                        legend: {
                            display: false,
                            position: "bottom",
                            labels: {
                                fontColor: "#000",
                                //boxWidth:50,
                                fontSize: 14,
                                //fontSize:'26px'
                                //fontWeight:700
                            },
                        },
                        legendCallback: function(chart) {
                            var text = [];
                            text.push('<ul class="0-legend">');
                            var ds = chart.data.datasets[0];
                            var sum = ds.data.reduce(function add(a, b) {
                                return a + b;
                            }, 0);
                            for (var i = 0; i < ds.data.length; i++) {
                                text.push("<li>");
                                var perc = Math.round((100 * ds.data[i]) / sum, 0);
                                text.push(
                                    '<span style="background-color:' +
                                    ds.backgroundColor[i] +
                                    '">' +
                                    "</span>" +
                                    chart.data.labels[i]
                                );
                                text.push("</li>");
                            }
                            text.push("</ul>");
                            return text.join("");
                        },
                        elements: {
                            arc: {
                                borderWidth: 0,
                            },
                        },
                    },
                });

                $(`#legend${i}`).html(myPieChart.generateLegend());
            });
        }
    </script>
</body>

</html>